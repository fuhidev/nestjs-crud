"use strict";var W=Object.defineProperty;var C=(e,t,i)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var u=(e,t,i)=>(C(e,typeof t!="symbol"?t+"":t,i),i);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const j=require("axios");class o extends Error{constructor(t){super(t)}}const q="||",g=",",L=e=>Object.keys(e),M=e=>Object.getOwnPropertyNames(e),S=e=>typeof e>"u",P=e=>e===null,h=e=>S(e)||P(e),F=e=>typeof e=="string",b=e=>e.length>0,f=e=>F(e)&&b(e),m=e=>Array.isArray(e)&&b(e),T=e=>m(e)&&e.every(t=>f(t)),l=e=>typeof e=="object"&&!P(e),H=e=>l(e)&&b(L(e)),U=e=>typeof e=="number"&&!Number.isNaN(e)&&Number.isFinite(e),p=(e,t)=>e===t,k=e=>e===!1,V=e=>e===!0,K=(e,t=[])=>t.some(i=>p(e,i)),E=e=>typeof e=="boolean",X=e=>/^[+-]?([0-9]*[.])?[0-9]+$/.test(e),Z=e=>f(e)&&/^\d{4}-[01]\d-[0-3]\d(?:T[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:Z|[-+][0-2]\d(?::?[0-5]\d)?)?)?$/g.test(e),B=e=>e instanceof Date,$=e=>f(e)||U(e)||E(e)||B(e),w=e=>m(e)?e.every(t=>$(t)):$(e),z=e=>typeof e=="function";var I=(e=>(e.Intersects="intersects",e.Within="within",e.Touches="touches",e))(I||{}),O=(e=>(e.EQUALS="$eq",e.NOT_EQUALS="$ne",e.GREATER_THAN="$gt",e.LOWER_THAN="$lt",e.GREATER_THAN_EQUALS="$gte",e.LOWER_THAN_EQUALS="$lte",e.STARTS="$starts",e.ENDS="$ends",e.CONTAINS="$cont",e.EXCLUDES="$excl",e.IN="$in",e.NOT_IN="$notin",e.IS_NULL="$isnull",e.NOT_NULL="$notnull",e.BETWEEN="$between",e.EQUALS_LOW="$eqL",e.NOT_EQUALS_LOW="$neL",e.STARTS_LOW="$startsL",e.ENDS_LOW="$endsL",e.CONTAINS_LOW="$contL",e.EXCLUDES_LOW="$exclL",e.IN_LOW="$inL",e.NOT_IN_LOW="$notinL",e))(O||{});const G=["eq","ne","gt","lt","gte","lte","starts","ends","cont","excl","in","notin","isnull","notnull","between"],A=Object.assign(G,L(O).map(e=>O[e])),N=["ASC","DESC"],Y=A.join(),tt=N.join();function _(e){if(!T(e))throw new o("Invalid fields. Array of strings expected")}function Q(e,t){if(!l(e)||!f(e.field))throw new o(`Invalid field type in ${t} condition. String expected`);x(e.operator)}function x(e){if(!A.includes(e))throw new o(`Invalid comparison operator. ${Y} expected`)}function R(e){if(!l(e)||!f(e.field))throw new o("Invalid join field. String expected");if(!S(e.select)&&!T(e.select))throw new o("Invalid join select. Array of strings expected")}function v(e){if(!l(e)||!f(e.field))throw new o("Invalid sort field. String expected");if(!p(e.order,N[0])&&!p(e.order,N[1]))throw new o(`Invalid sort order. ${tt} expected`)}function J(e,t){if(!U(e))throw new o(`Invalid ${t}. Number expected`)}function et(e,t){if(!l(e))throw new o(`Invalid param ${t}. Invalid crud options`);const i=e[t];if(!(i&&i.disabled)&&(!l(i)||h(i.field)||h(i.type)))throw new o("Invalid param option in Crud")}function it(e,t){const i=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)&&!i.test(e))throw new o(`Invalid param ${t}. UUID string expected`)}const c=class c{constructor(){u(this,"paramNames",{});u(this,"queryObject",{});u(this,"filterGeo");u(this,"_fields");this.setParamNames()}get fields(){return this._fields}static setOptions(t){c._options={...c._options,...t,paramNamesMap:{...c._options.paramNamesMap,...t.paramNamesMap?t.paramNamesMap:{}}}}static getOptions(){return c._options}static create(t){const i=new c;return l(t)?i.createFromParams(t):i}get options(){return c._options}setParamNames(){Object.keys(c._options.paramNamesMap).forEach(t=>{const i=c._options.paramNamesMap[t];this.paramNames[t]=F(i)?i:i[0]})}query(){var i;if(this.queryObject[this.paramNames.search]&&(this.queryObject[this.paramNames.filter]=void 0,this.queryObject[this.paramNames.or]=void 0),!this.queryObject.fields||((i=this.queryObject.fields)==null?void 0:i.length)===0)throw new Error("required fields");let t="";for(const s in this.queryObject)this.queryObject.hasOwnProperty(s)&&(t!==""&&(t+="&"),m(this.queryObject[s])?t+=this.queryObject[s].map(r=>`${s}=${r}`).join("&"):t+=`${s}=${this.queryObject[s]}`);return t}select(t){return m(t)&&(_(t),this._fields=t,this.queryObject[this.paramNames.fields]=t.join(g)),this}search(t){return!h(t)&&l(t)&&(this.queryObject[this.paramNames.search]=JSON.stringify(t)),this}setFilter(t){return this.setCondition(t,"filter"),this}setOr(t){return this.setCondition(t,"or"),this}setJoin(t){if(!h(t)){const i=this.checkQueryObjectParam("join",[]),s=[];Array.isArray(t)?t.forEach(r=>s.push(...this.addJoin(r))):s.push(...this.addJoin(t)),this.queryObject[i]=[...this.queryObject[i],...s]}return this}sortBy(t){if(!h(t)){const i=this.checkQueryObjectParam("sort",[]);this.queryObject[i]=[...this.queryObject[i],...Array.isArray(t)?t.map(s=>this.addSortBy(s)):[this.addSortBy(t)]]}return this}setLimit(t){return this.setNumeric(t,"limit"),this}setOutSR(t){return t&&(this.queryObject.outSR=JSON.stringify(t)),this}setInSR(t){return t&&(this.queryObject.inSR=JSON.stringify(t)),this}setBBox(t){return t&&(this.queryObject.bbox=JSON.stringify(t)),this}setFilterGeo(t){return this.filterGeo=t,this}setFormatGeo(t){return t&&(this.queryObject.fGeo=t),this}setOffset(t){return this.setNumeric(t,"offset"),this}setPage(t){return this.setNumeric(t,"page"),this}resetCache(){return this.setNumeric(0,"cache"),this}cond(t,i="search"){Q(t,i);const s=q;let r="",n=t.value;return w(n)&&(typeof n=="number"?r=n.toString():typeof n=="string"?n.startsWith('"')&&n.endsWith('"')?r=n:r=`"${n}"`:Array.isArray(n)&&(r=n.map(y=>typeof y=="string"?n.startsWith('"')&&n.endsWith('"')?y:`"${y}"`:y).join(","))),`${t.field}${s}${t.operator}${s}${r}`}addJoin(t,i){const s=[];R(t);const r=q,n=g,a=i?t.field+"."+i:t.field+"";return s.push(a+(m(t.select)?r+t.select.join(n):"")),s}addSortBy(t){v(t);const i=g;return t.field+i+t.order}createFromParams(t){return this.select(t.fields),this.search(t.search),this.setFilter(t.filter),this.setOr(t.or),this.setJoin(t.join),this.setLimit(t.limit),this.setOffset(t.offset),this.setPage(t.page),this.sortBy(t.sort),this.setFormatGeo(t.fGeo),this.setFilterGeo(t.filterGeo),this.setBBox(t.bbox),this.setOutSR(t.outSR),this.setInSR(t.inSR),t.resetCache&&this.resetCache(),this}checkQueryObjectParam(t,i){const s=this.paramNames[t];return h(this.queryObject[s])&&!S(i)&&(this.queryObject[s]=i),s}setCondition(t,i){if(!h(t)){const s=this.checkQueryObjectParam(i,[]);this.queryObject[s]=[...this.queryObject[s],...Array.isArray(t)?t.map(r=>this.cond(r,i)):[this.cond(t,i)]]}}setNumeric(t,i){h(t)||(J(t,i),this.queryObject[this.paramNames[i]]=t)}};u(c,"_options",{paramNamesMap:{fields:["fields","select"],search:"s",filter:"filter",or:"or",join:"join",sort:"sort",limit:["limit","per_page"],offset:"offset",page:"page",cache:"cache"}});let d=c;class st{constructor(t){u(this,"entity");u(this,"apiUrl");u(this,"primaryKey");this.entity=t.entity,this.apiUrl=t.apiUrl,this.primaryKey=t.primaryKey}request(t){return j.request(t).then(i=>i.data)}getPagination(t,i,s){s=s||{};let{builder:r,signal:n}=s;r?r instanceof d||(r=d.create(r)):r=d.create(),r.setLimit(t),r.setPage(i);const a=this.getBodyFilterGeo(r);return a?this.request({signal:n,url:this.getBaseUrl()+"/query",method:"POST",data:JSON.stringify(a),params:this.getParamsFromQuery(r),headers:{"Content-Type":"application/json"}}):this.request({url:this.getBaseUrl(),method:"GET",params:this.getParamsFromQuery(r)})}getMany(t){t=t||{};let{builder:i,signal:s}=t;const r=this.getBodyFilterGeo(i);return r?this.request({url:this.getBaseUrl()+"/query",data:JSON.stringify(r),method:"POST",signal:s,params:this.getParamsFromQuery(i),headers:{"Content-Type":"application/json"}}):this.request({url:this.getBaseUrl(),method:"GET",params:this.getParamsFromQuery(i)})}getCount(t){return this.request({url:this.getBaseUrl()+"/count",params:this.getParamsFromQuery(t)})}getOne(t,i){i=i||{};let{builder:s,signal:r}=i;const n=this.getOneUrl(t),a=this.getBodyFilterGeo(s);return a?this.request({url:this.getBaseUrl()+`/query/${t}`,data:JSON.stringify(a),method:"POST",signal:r,params:this.getParamsFromQuery(s),headers:{"Content-Type":"application/json"}}):this.request({url:n,params:this.getParamsFromQuery(s)})}getBodyFilterGeo(t){let i;return typeof t=="object"&&(t.filterGeo,i=t.filterGeo),i?{filterGeo:i}:null}create(t,i){i=i||{};let{builder:s,signal:r}=i;return this.getBodyFilterGeo(s),this.request({url:this.getBaseUrl(),data:JSON.stringify({...t,...this.getBodyFilterGeo(s)}),method:"POST",signal:r,params:this.getParamsFromQuery(s),headers:{"Content-Type":"application/json"}})}createMany(t,i){i=i||{};let{builder:s,signal:r}=i;return this.request({url:this.getBaseUrl()+"/bulk",data:JSON.stringify({bulk:t,...this.getBodyFilterGeo(s)}),params:this.getParamsFromQuery(s),method:"POST",signal:r,headers:{"Content-Type":"application/json"}})}put(t,i,s){s=s||{};let{builder:r,signal:n}=s;const a=this.getOneUrl(t);return j.put(a,JSON.stringify({...i,...this.getBodyFilterGeo(r)}),{params:this.getParamsFromQuery(r),signal:n,method:"PUT",headers:{"Content-Type":"application/json"}}).then(y=>y.data)}patch(t,i,s){s=s||{};let{builder:r,signal:n}=s;const a=this.getOneUrl(t);return this.request({url:a,data:JSON.stringify({...i,...this.getBodyFilterGeo(r)}),method:"PATCH",params:this.getParamsFromQuery(r),signal:n,headers:{"Content-Type":"application/json"}})}executeSql(t){return j.post(this.getBaseUrl()+"/execute",JSON.stringify(t),{headers:{"Content-Type":"application/json"}})}delete(t){return this.request({method:"DELETE",url:this.getBaseUrl()+"/"+t})}getParamsFromQuery(t){return t instanceof d||(t=d.create(t)),this.getQuery(t)}getBaseUrl(){return`${this.apiUrl}/${this.entity}`}getOneUrl(t){return`${this.getBaseUrl()}/${t}`}getQuery(t){return t?t.queryObject:{}}}var D=(e=>(e.Polygon="Polygon",e.Polyline="Polyline",e.Point="Point",e))(D||{});exports.CondOperator=O;exports.CrudBaseService=st;exports.DELIMSTR_CHAR=g;exports.DELIM_CHAR=q;exports.GeometryType=D;exports.RequestQueryBuilder=d;exports.RequestQueryException=o;exports.SpatialMethodEnum=I;exports.comparisonOperatorsList=A;exports.deprecatedComparisonOperatorsList=G;exports.getOwnPropNames=M;exports.hasLength=b;exports.hasValue=w;exports.isArrayFull=m;exports.isArrayStrings=T;exports.isBoolean=E;exports.isDate=B;exports.isDateString=Z;exports.isEqual=p;exports.isFalse=k;exports.isFunction=z;exports.isIn=K;exports.isNil=h;exports.isNull=P;exports.isNumber=U;exports.isNumeric=X;exports.isObject=l;exports.isObjectFull=H;exports.isString=F;exports.isStringFull=f;exports.isTrue=V;exports.isUndefined=S;exports.isValue=$;exports.objKeys=L;exports.sortOrdersList=N;exports.validateComparisonOperator=x;exports.validateCondition=Q;exports.validateFields=_;exports.validateJoin=R;exports.validateNumeric=J;exports.validateParamOption=et;exports.validateSort=v;exports.validateUUID=it;
